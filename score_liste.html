<!DOCTYPE html>
<html>
<head>
<meta content="yes" name="apple-mobile-web-app-capable" />
<meta content="text/html; charset=iso-8859-1" http-equiv="Content-Type" />
<meta content="minimum-scale=1.0, width=device-width, maximum-scale=0.6667, user-scalable=no" name="viewport" />
<meta name="format-detection" content="telephone=no" />
<link rel="shortcut icon" type="image/x-icon" href="images/golf.png?">
<link href="misc/format.css" rel="stylesheet" media="screen" type="text/css" />
<link href="misc/golfGPS.css" rel="stylesheet" media="screen" type="text/css" />

<title>Clubs de golf au Québec</title>
<meta content="Golf, Québec, Canada, Golf du Québec, Clubs de golf au Québec, Québec golf" name="keywords" />
<meta content="Répertoire des clubs de golf du Québec." name="description" />

<meta name="viewport" content="initial-scale=1.0, user-scalable=no" /> 

<style>
table.cartePts tr:focus, tr:active{color: #FF3333}

#menuList{
display:none;
position: absolute;
background: #eee;
}

#menuList td{
border: buttonhighlight 2px inset;
background: #eee;
cursor: pointer;
text-align: left;
padding: 5px;
padding-left: 10px;
width: auto;
}

#menuList td:hover{
background: #999 ;
cursor: pointer;

}

#divLoad{
text-align: center;
}

</style>

<script type="text/javascript" src="misc/util.js"></script>
<script type="text/javascript" src="misc/utilGolfGPS.js"></script>
<script type="text/javascript" src="misc/geoLocal.js"></script>

<script type="text/javascript"> 
<!--
if (isTouchDevice){
	document.getElementById('p1').addEventListener('touchstart', function(event) {
	event.preventDefault();
	}, false);
	document.getElementById('p1').addEventListener('touchend', function(event) {
	event.preventDefault();
	}, false);
}

var userId;
var skip = 0;
var gameCount = 0;
var limit= 0;
var localWindow=null;

function show_score(gameID, clubName){
//alert('liste');
localWindow=null;
localWindow = window.open('scoreTab.html?data=' + gameID + "$" + clubName);
localWindow.document.close();
}


function initPage(){

setFontSize();
userId = GetCookie("userID");

var data = getURLdata();

initCount();
}

function initCount(){
var formPref = document.getElementById('formPref');
var nbrTrous = parseInt(formPref.prefTrous.value);

getInfo("countUserGame?data=" + userId + "$" + nbrTrous, getGameList);
}


function getGameList(oCount, tel){
var formPref = document.getElementById('formPref');
var divLoad = document.getElementById('divLoad');

divLoad.style.display = "inherit";

var sh = document.styleSheets[0];
var Wait_on="* {cursor: wait !important}";
sh.insertRule(Wait_on, 0);

localStorage.setItem('gameListPrefTrous', formPref.prefTrous.selectedIndex);
localStorage.setItem('gameListPrefNbr', formPref.prefNbr.selectedIndex);

var date = Date.parse(formPref.prefDate.value);
if (!date)
	date = 0;
var nbrTrous = parseInt(formPref.prefTrous.value);
var actLimit = limit;
limit= parseInt(formPref.prefNb.value);

if (oCount){
	gameCount = oCount;
	skip = 0;
}else{
	if (!tel)
		skip += actLimit ;
}
if (skip >= gameCount)
	skip = 0;
if (skip + limit > gameCount)
	limit = gameCount - skip ;
if (date) // If date then start to date
	skip = 0;

if (!tel)
	getInfo("getGameList?user=" + userId + "&skip=" + skip + "&limit=" + limit + "&is18=" + nbrTrous  + "&date=" + date, showGameList);
else{
	var param = ("getGameList?user=" + userId + "&skip=" + skip + "&limit=" + limit + "&is18=" + nbrTrous  + "&date=" + date + "&tele=" + tel);
	document.location.href = HOSTserv + param;
	}
}


function calcScore(oScore){
var tot = 0;
for (var i = 1; i < 19; i++) {
	tot += (eval("oScore.T" + i));
}

return tot;
}

function telGameList(option){
var menuList = document.getElementById('menuList');

if (option > 0){
	getGameList(false, option);
}
menuList.style.display = "none";
}

function showGameList(scoreData){
var gameList = document.getElementById('gameList');
var divLoad = document.getElementById('divLoad');

divLoad.style.display = "none";
divLoad.style.position = "absolute";
divLoad.style.marginLeft  = "45%";
divLoad.style.top = ( divLoad.parentElement.offsetTop + 50 ) + "px";


var listTot = 0, nbrGame = 0;
//coupTot = coupTot + orecordset("score")

var Tcode = '<tr><th>Date</th><th>Club</th><th>Score</th></tr>';
var arrHDP = new Array();

for (var i = 0; i < scoreData.length; i++) {
	var scoreID = scoreData[i]._id;
	var courseName = scoreData[i].name;
	Tcode += '<tr class="norm" ontouchstart="this.className=\'rowOver\'" ontouchend="this.className=\'rowNorm\'" onmouseover="this.className=\'rowOver\'" onmouseout="this.className=\'rowNorm\'" onclick="show_score(\'' + scoreID + '\',' + '\'' + courseName + '\');">';
	//'<td><%=orecordset("Sdate")%></td><td><%=orecordset("nom")%></td><td><%=orecordset("score")%></td></tr>';
	var gt = calcScore(scoreData[i]);
	arrHDP[arrHDP.length] = gt;
	listTot += gt;
	nbrGame += 1;
	Tcode += '<td>' + (scoreData[i].score_date) + '</td><td>' + scoreData[i].name + '</td><td>' + gt + '</td></tr>';
//'<td><%=orecordset("Sdate")%></td><td><%=orecordset("nom")%></td><td><%=orecordset("score")%></td></tr>';
}

if (i == 20)
	var hdp = "Hand.: " + calcHDP(arrHDP);
else
	var hdp = "";

Tcode += '<tr><td><strong>' + hdp + '</strong></td><td><strong>' + nbrGame + '&nbsp;parties</strong></td><td><strong>Moy.: ' + (Math.round(listTot/limit*10) /10 ) + '</strong></td></tr>';

//'<tr><td><strong>Moyenne</strong></td><td><strong><%=i%>&nbsp;parties</strong></td><td><strong><%=round(coupTot/i,1)%></strong></td></tr>';

gameList.innerHTML = Tcode;

var sh = document.styleSheets[0];
sh.deleteRule(0);

}

function calcHDP(arrHDP){
var hdp = 0;
arrHDP.sort(function(a, b){return a-b});

for (var i = 0; i < 10; i++) {
	hdp += arrHDP[i];
}
return (hdp / 10);
}

function setNB(oNbr){
var prefNb = document.getElementById('prefNb');
prefNb.value = oNbr.value;
}

function optGameList(objOpt){
var menuList = document.getElementById('menuList');

menuList.style.left = objOpt.offsetLeft + "px";
menuList.style.top = objOpt.offsetTop  + objOpt.offsetHeight  +"px";

if (menuList.style.display == "inherit")
	menuList.style.display = "none";
else
	menuList.style.display = "inherit";

}

// -->
</script> 
</head>
<body onload="initPage()">
<div id="duobutton"><a href="#"  onclick="window.close(); return false;">Fermer</a>
<button type="button" id="changeTaille" title="Taille de police" onclick="changeTaille()"><img id="imgTaille" alt="Taille de police" height="20" width="45" src="images/taille.png" /></button>
</div>

<form id="formPref" action="#">

<div class="prefPart">
<input id="prefDate" type="text" size="8" placeholder="aaaa/mm/jj"/>
<select id="prefTrous" onchange="initCount()">
 <option value="18" selected>18 trous</option>
 <option value="9" >9 trous</option>
 <option value="T" >Tous</option>
</select>
<div id="prefNbr">
<select id="prefNbr" onchange="setNB(this)">
 <option value="5" >5 parties</option>
 <option value="10" selected>10 parties</option>
 <option value="20" >20 parties H</option>
 <option value="50" >50 parties</option>
  <option value="100" >100 parties</option>
</select>
<input id="prefNb" type"text" size="3" value="10"/>
</div>
</div>


<div id="p1" name="p1" class="unselectable">
	<table class="cartePts">
	<tbody id="gameList">
<div id="divLoad"><img id="imgLoad" alt="Chargement en cours..." height="64" width="64" src="images/loading.gif" /></div>
	</tbody>
	</table>
</div>

<div class="space10">
&nbsp;<input name="nextGame" class="itin" type="button" onclick="getGameList()" value="Parties suivantes">
</div>
<div class="space10">
&nbsp;<input name="telGame" class="itin" type="button" onclick="optGameList(this)" value="T&eacute;l&eacute;charger">
</div>

<div id="menuList">
<table><tbody>
<tr><td onclick="telGameList(1);" title="T&eacute;l&eacute;charger un fichier csv.">Format csv...</td></tr>
<tr><td onclick="telGameList(2);" title="T&eacute;l&eacute;charger un fichier json.">Format json...</td></tr>
<tr><td onclick="telGameList(0);">Annuler</td></tr>
</tbody></table>
</div>

</form>
&nbsp;
</body>
