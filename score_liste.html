<!DOCTYPE html>
<html>
<head>
<meta content="yes" name="apple-mobile-web-app-capable" />
<meta content="text/html; charset=iso-8859-1" http-equiv="Content-Type" />
<meta content="minimum-scale=1.0, width=device-width, maximum-scale=0.6667, user-scalable=no" name="viewport" />
<meta name="format-detection" content="telephone=no" />
<link rel="shortcut icon" type="image/x-icon" href="images/golf.png?">
<link href="misc/format.css" rel="stylesheet" media="screen" type="text/css" />
<link href="misc/golfGPS.css" rel="stylesheet" media="screen" type="text/css" />

<title>Clubs de golf au Québec</title>
<meta content="Golf, Québec, Canada, Golf du Québec, Clubs de golf au Québec, Québec golf" name="keywords" />
<meta content="Répertoire des clubs de golf du Québec." name="description" />

<meta name="viewport" content="initial-scale=1.0, user-scalable=no" /> 

<style>
table.cartePts tr:focus, tr:active{color: #FF3333}

#divOptions{
height: 0px;
overflow: hidden;
transition: height 0.4s ease-in-out;
}

#menuList, #submenu1{
position: absolute;
background: #eee;
overflow: hidden;
height: 0px;
transition: height 0.4s ease-in-out;
}

#submenu1{
display: none;
height: auto;
}

#menuList td, #submenu1 td{
border: buttonhighlight 2px inset;
background: #eee;
cursor: pointer;
text-align: left;
padding: 5px;
padding-left: 10px;
width: auto;
}

#menuList td:hover, #submenu1 td:hover{
background: #999 ;
cursor: pointer;
}

#butMenu{
float: left;
}

.tdEdit{
visibility:hidden;
width: 1% !important;
max-width: 1% !important;
}

.tdEditOn{
visibility:visible;
width: 1% !important;
max-width: 1% !important;
}

</style>

<script type="text/javascript" src="misc/util.js"></script>
<script type="text/javascript" src="misc/utilGolfGPS.js"></script>
<script type="text/javascript" src="misc/geoLocal.js"></script>

<script type="text/javascript"> 
<!--

var editMode = false;
var menuOn = false;

if (isTouchDevice){
	document.getElementById('p1').addEventListener('touchstart', function(event) {
	event.preventDefault();
	closeMenu();
	}, false);
	document.getElementById('p1').addEventListener('touchend', function(event) {
	event.preventDefault();
	}, false);
}

var userId;
var skip = 0;
var gameCount = 0;
var limit= 0;
var localWindow=null;

function show_score(gameID, clubName){
if (!editMode){
	localWindow=null;
	localWindow = window.open('scoreTab.html?data=' + gameID + "$" + clubName);
	localWindow.document.close();
}
}

function initPage(){
var p1 = document.getElementById('p1');
p1.addEventListener("mouseover", function() {
    closeMenu();
}); 

setFontSize();
userId = GetCookie("userID");

var data = getURLdata();

initCount();
}

function initCount(){
var formPref = document.getElementById('formPref');
var nbrTrous = parseInt(formPref.prefTrous.value);

getInfo("countUserGame?data=" + userId + "$" + nbrTrous, getGameList);
}


function getGameList(oCount, tel){
var formPref = document.getElementById('formPref');
var divLoad = document.getElementById('divLoad');

closeMenu();
divLoad.style.top = ( divLoad.parentElement.offsetHeight + divLoad.parentElement.offsetTop - 100 ) + "px";
divLoad.style.display = "inherit";

var sh = document.styleSheets[0];
var Wait_on="* {cursor: wait !important}";
sh.insertRule(Wait_on, 0);

localStorage.setItem('gameListPrefTrous', formPref.prefTrous.selectedIndex);
localStorage.setItem('gameListPrefNbr', formPref.prefNbr.selectedIndex);

var date = Date.parse(formPref.prefDate.value);
if (!date)
	date = 0;
var nbrTrous = parseInt(formPref.prefTrous.value);
var actLimit = limit;
limit= parseInt(formPref.prefNb.value);

if (oCount){
	gameCount = oCount;
	skip = 0;
}else{
	if (!tel)
		skip += actLimit ;
}
if (skip >= gameCount)
	skip = 0;
if (skip + limit > gameCount)
	limit = gameCount - skip ;
if (date) // If date then start to date
	skip = 0;

if (!tel || tel == 99){
	if (tel == 99){
		limit--;
		gameCount--;
		}
	if (gameCount == 0){
		var noGame = {};
		noGame.length = 0;
		showGameList(noGame);
	}else
		getInfo("getGameList?user=" + userId + "&skip=" + skip + "&limit=" + limit + "&is18=" + nbrTrous  + "&date=" + date, showGameList);
}else{
	var param = ("getGameList?user=" + userId + "&skip=" + skip + "&limit=" + limit + "&is18=" + nbrTrous  + "&date=" + date + "&tele=" + tel);
	document.location.href = HOSTserv + param;
	stopLoad();
	}
}


function calcScore(oScore){
var tot = 0;
for (var i = 1; i < 19; i++) {
	tot += (eval("oScore.T" + i));
}

return tot;
}

function telGameList(option){
closeMenu();
if (option > 0){
	getGameList(false, option);
}
}

function closeMenu(){
if (menuOn){
	var menuList = document.getElementById('menuList');
	var submenu = document.getElementById('submenu1');

	submenu.style.display = "none";
	menuList.style.height = "0px";
	menuOn = false;
}
}

function showGameList(scoreData){
var gameList = document.getElementById('gameList');

stopLoad();
var listTot = 0, nbrGame = 0;
//coupTot = coupTot + orecordset("score")

var Tcode = '<tr><th>Date</th><th>Club</th><th>Score</th><th class="tdEdit"></th></tr>';
var arrHDP = new Array();

for (var i = 0; i < scoreData.length; i++) {
	var scoreID = scoreData[i]._id;
	var courseName = scoreData[i].name;
	Tcode += '<tr class="norm" ontouchstart="this.className=\'rowOver\'" ontouchend="this.className=\'rowNorm\'" onmouseover="this.className=\'rowOver\'" onmouseout="this.className=\'rowNorm\'" onclick="show_score(\'' + scoreID + '\',' + '\'' + courseName + '\');">';
	var gt = calcScore(scoreData[i]);
	arrHDP[arrHDP.length] = gt;
	listTot += gt;
	nbrGame += 1;
	Tcode += '<td>' + (scoreData[i].score_date) + '</td><td>' + scoreData[i].name + '</td><td>' + gt + '</td>';
	Tcode += '<td class="tdEdit"><img onclick="delGame(this.parentNode.parentNode.childNodes,\'' + scoreID + '\')" height="16" width="16" src="images/delete.png" /></td></tr>'
//'<td><%=orecordset("Sdate")%></td><td><%=orecordset("nom")%></td><td><%=orecordset("score")%></td></tr>';
}

if (i == 20)
	var hdp = "Hand.: " + calcHDP(arrHDP);
else
	var hdp = "";

Tcode += '<tr><td><strong>' + hdp + '</strong></td><td><strong>' + nbrGame + '&nbsp;parties</strong></td><td><strong>Moy.: ' + (Math.round(listTot/limit*10) /10 ) + '</strong></td><td class="tdEdit"></td></tr>';

//'<tr><td><strong>Moyenne</strong></td><td><strong><%=i%>&nbsp;parties</strong></td><td><strong><%=round(coupTot/i,1)%></strong></td></tr>';

gameList.innerHTML = Tcode;

if (editMode){
	editMode = false;
	editGame(false);
}

}

function stopLoad(){
var divLoad = document.getElementById('divLoad');
divLoad.style.display = "none";
divLoad.style.position = "absolute";
divLoad.style.marginLeft  = "45%";
var sh = document.styleSheets[0];
sh.deleteRule(0);
}

function calcHDP(arrHDP){
var hdp = 0;
arrHDP.sort(function(a, b){return a-b});

for (var i = 0; i < 10; i++) {
	hdp += arrHDP[i];
}
return (hdp / 10);
}

function setNB(oNbr){
var prefNb = document.getElementById('prefNb');
prefNb.value = oNbr.value;
}

function optGameList(objOpt){
var menuList = document.getElementById('menuList');

menuList.style.left = objOpt.offsetLeft + "px";
menuList.style.width = menuList.childNodes[1].offsetWidth + "px";

if (menuList.style.height != "0px"){
	closeMenu();
}else{
	menuList.style.height = "150px";
	}
}

function showMenu(){
var menuList = document.getElementById('menuList');

if (menuList.style.height != "0px"){
	menuList.style.height = "0px";
}else{
	var adj = menuList.childNodes[1].offsetHeight;
	menuList.style.height = (adj * .75) + "pt";
	}
menuOn = true;
}

function showSubmenu(objOpt, state){
var submenu = document.getElementById('submenu1');

if (objOpt){
	submenu.style.left = objOpt.offsetWidth + "px";
	submenu.style.top = (objOpt.offsetTop + 32) + "px";
}

submenu.style.display = state;

}

function showOptions(menuTxt){
var divOptions = document.getElementById('divOptions');

if (divOptions.style.height != "0px" && divOptions.style.height != ""){
	divOptions.style.height = "0px";
	menuTxt.innerHTML = "&nbsp;&nbsp;&nbsp;&nbsp;Options";
}else{
	var fur = navigator.userAgent;
	var adj = menuTxt.offsetHeight * 2.1 ;
	if(fur.indexOf('Safari') == -1)
		adj = (adj * .77);
	divOptions.style.height = adj + "px";
	//divOptions.style.height = adj + "3em";
	menuTxt.innerHTML = "&#10004;&nbsp;Options";
	}
}

function changeTailleP(){
closeMenu();
changeTaille();
}

function editGame(menuTxt){
				
if (editMode){
	if (menuTxt)
		menuTxt.innerHTML = "&nbsp;&nbsp;&nbsp;&nbsp;&Eacute;diter";
	editMode = false;
	var elem = document.getElementsByClassName("tdEditOn");
	while(elem.length > 0) {
		elem[0].className = 'tdEdit'; 
		}
}else{
	if (menuTxt)
		menuTxt.innerHTML = "&#10004;&nbsp;&Eacute;diter";
	editMode = true;
	var elem = document.getElementsByClassName("tdEdit");
	while(elem.length > 0) {
		elem[0].className = 'tdEditOn';  
		}
	}
}

function delGame(rChilds, id){
if (confirm("Supprimer cette partie ?\n - Date: " + rChilds[0].innerHTML + " \n - Club: " + rChilds[1].innerHTML + "\n - Score: " + rChilds[2].innerHTML)){
	getInfo("delGame?id=" + id, showDelRes);
}
}

function showDelRes(oRes){
if (oRes.ok){
	getGameList(false, 99);
}else{
	alert(oRes);
}
}

// -->
</script> 
</head>
<body onload="initPage()">
<div id="duobutton">
<a href="#"  id="butMenu" title="Menu" onclick="showMenu()"><img id="logomenu" alt="Menu" height="32" width="64" src="images/menu.png" /></a>
<a href="#"  onclick="window.close(); return false;">Fermer</a>
<button type="button" id="changeTaille" title="Taille de police" onclick="changeTailleP()"><img id="imgTaille" alt="Taille de police" height="20" width="45" src="images/taille.png" /></button>
</div>

<div id="menuList">
<table><tbody>
<tr><td onclick="editGame(this);" title="T&eacute;l&eacute;charger un fichier csv.">&nbsp;&nbsp;&nbsp;&nbsp;&Eacute;diter</td></tr>
<tr><td onclick="showOptions(this);" title="Options de recherche.">&nbsp;&nbsp;&nbsp;&nbsp;Options</td></tr>
<tr><td onclick="showSubmenu(this, 'inherit');" onmouseover="showSubmenu(this, 'inherit');" onmouseout="showSubmenu(this, 'none');" title="T&eacute;l&eacute;charger un fichier json.">&nbsp;&nbsp;&nbsp;&nbsp;T&eacute;l&eacute;charger&nbsp;&#9658;</td></tr>
<tr><td onclick="telGameList(0);">&nbsp;&nbsp;&nbsp;&nbsp;Annuler</td></tr>
</tbody></table>
</div>

<div id="submenu1">
<table><tbody>
<tr><td onclick="telGameList(1);" onmouseover="showSubmenu(false, 'inherit');" title="T&eacute;l&eacute;charger un fichier csv.">Format csv...</td></tr>
<tr><td onclick="telGameList(2);" title="T&eacute;l&eacute;charger un fichier json.">Format json...</td></tr>
</tbody></table>
</div>

<form id="formPref" action="#">

<div id="divOptions" class="prefPart">
<input id="prefDate" type="text" size="8" placeholder="aaaa/mm/jj"/>
<select id="prefTrous" onchange="initCount()">
 <option value="18" selected>18 trous</option>
 <option value="9" >9 trous</option>
</select>
<div id="prefNbr">
<select id="prefNbr" onchange="setNB(this)">
 <option value="5" >5 parties</option>
 <option value="10" selected>10 parties</option>
 <option value="20" >20 parties H</option>
 <option value="50" >50 parties</option>
  <option value="100" >100 parties</option>
</select>
<input id="prefNb" type"text" size="3" value="10"/>
</div>
</div>

<div id="p1" name="p1" class="unselectable">
	<table class="cartePts">
	<tbody id="gameList">
<div id="divLoad"><img id="imgLoad" alt="Chargement en cours..." height="64" width="64" src="images/loading.gif" /></div>
	</tbody>
	</table>
</div>

<div class="space10">
&nbsp;<input name="nextGame" class="itin" type="button" onclick="getGameList()" value="Parties suivantes">
</div>

</form>
&nbsp;
</body>
