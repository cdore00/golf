<!DOCTYPE html>
<html>
<head>
<meta content="yes" name="apple-mobile-web-app-capable" />
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<meta content="minimum-scale=1.0, width=device-width, maximum-scale=0.6667, user-scalable=no" name="viewport" />
<meta name="format-detection" content="telephone=no" />

<link rel="shortcut icon" type="image/x-icon" href="images/golf.png?">
<title>Golfs du Qu&eacute;bec</title>
<meta content="Golf GPS, Qu&eacute;bec, Canada, Golf du Qu&eacute;bec, Clubs de golf au Qu&eacute;bec, Qu&eacute;bec golf" name="keywords" />
<meta content="R&eacute;pertoire des clubs de golf du Qu&eacute;bec. GPS golf." name="description" />
<link href="misc/init.css" rel="stylesheet" media="screen" type="text/css" />
<link href="misc/format.css" rel="stylesheet" media="screen" type="text/css" /> 

    <script type="text/javascript" 
      src="https://maps.googleapis.com/maps/api/js?key=AIzaSyA15nyiYmWG_0IkG9H5r4Qc8KhZxwRw_xA&sensor=false"> 
    </script> 
	<script type="text/javascript" src="misc/util.js"></script>
	<script type="text/javascript" src="misc/markerLabel.js"></script>
	<script type="text/javascript" src="misc/geoLocal.js"></script>
	
<script type="text/javascript"> 
<!--

var map;
var posMarker;
var watchId = null;
var locTimer = null;
var locCollection = null;
var watchLoc = false;
var AffLoc = false, recenter = true;
var lastTime = 0;

var speedTime = {
	coord2 : [],
	lastTime : 0,
	lastPos : null,
	calcul : function (accPos,accTime) {
		var sp = 0;
		if (this.lastPos)
			var dist = calculDistance(this.lastPos, accPos);
		this.lastPos = accPos;
		if (dist){
			var elapsMilli = accTime - this.lastTime; 
			sp = (dist / 1760) / elapsMilli * 3600000;
			sp = Math.round(sp * 1.609344);
		}
		this.lastTime = accTime;
		return sp; 
	}
};

function initialize() { 
	locCollection = opener.locColl.coord;
	window.oTip = new messTipObject();
	window.oTip.show(false, false, false, false, 10);
	
	AffLoc = GetCookie("AffLoc");
	if (AffLoc)
	AffLoc = eval(AffLoc);
	//alert(locCollection.length);

	var myOptions = { 
	  center: new google.maps.LatLng(locCollection[locCollection.length-1].lat,locCollection[locCollection.length-1].lng), 
	  zoom: 19, 
	  panControl: false,    
	  zoomControl: false, 	  
	  scaleControl: false,
	  streetViewControl: false,
	  fullscreenControl: false, 
	  mapTypeControl: true,    
	  mapTypeControlOptions: { style: google.maps.MapTypeControlStyle.DROPDOWN_MENU, position: google.maps.ControlPosition.TOP_RIGHT   },
	  mapTypeId: google.maps.MapTypeId.HYBRID
	}; 
	map = new google.maps.Map(document.getElementById("map_canvas"), myOptions); 

	adjustScreen(31);
	setFontSize();
	//setMarkers(map, locCollection);
	setMyPosition(map, locCollection[locCollection.length-1].lat,locCollection[locCollection.length-1].lng);
	//alert(locCollection[locCollection.length-1].lat);
}

function setMyPosition(map, lat, lng) {
  // Add markers to the map
  var image = new google.maps.MarkerImage('images/ici.png',
      new google.maps.Size(14, 14),
      new google.maps.Point(0,0),
      new google.maps.Point(7, 7));
  var shape = {
      coord: [-10, -10, -10, 24, 24, 24, 24 , -10],
      type: 'poly'
  };
  //alert(location[1]);
    var myLatLng = new google.maps.LatLng(lat, lng);
    posMarker = new google.maps.Marker({
        position: myLatLng,
        map: map,
        icon: image,
        shape: shape,
        title: "Ma localisation",
        zIndex: 1000
		})
}
/*
function setMarkers(map, locations) {
  // Add markers to the map
  var image = new google.maps.MarkerImage('images/ici.png',
      new google.maps.Size(25, 25),
      new google.maps.Point(0,0),
      new google.maps.Point(0, 25));
  var shape = {
      coord: [1, 1, 1, 25, 25, 25, 25 , 1],
      type: 'poly'
  };
  for (var i = 0; i < locations.length - 1; i++) {
    var beach = locations[i];
    var myLatLng = new google.maps.LatLng(beach.lat, beach.lng);
    var marker = new MarkerWithLabel({
        position: myLatLng,
        map: map,
		draggable: true,
       labelContent: i ,
       labelAnchor: new google.maps.Point(3, 30),
       labelClass: "markLabels", // the CSS class for the label
       labelInBackground: false
		});
	}
}
*/

function lister() {
var divLayer = document.getElementById("prefLayer");

if (divLayer.style.visibility == "visible" ){
	divLayer.style.visibility="hidden";
}else{
 divLayer.style.visibility="visible";
	var donn = "";
	for (var i=0;i<locCollection.length;i++)
	{
	donn = donn + "</br>" + (i+1) + ": " + locCollection[i].lat + ", " + locCollection[i].lng + ", Pr&eacute;c: " + locCollection[i].acc;
	}
divLayer.innerHTML = donn;
}
 //alert(locCollection.length);
}

function localiser(){

watchLoc = document.typeLoc.typeLoc[0].checked;

//navigator.geolocation.stop();
//navigator.geolocation.start();
if (watchLoc){
	clearGeo();
	getLocalisationErr();
	}else
	getLocalisation();
}

function clearGeo(){
//alert(watchId);
navigator.geolocation.clearWatch(watchId);
}

function padStr(lng, chr, start){

}

function onLocSuccess(position) {
var myLatLng = new google.maps.LatLng(position.coords.latitude,position.coords.longitude);
var elaps = "";

posMarker.setPosition(myLatLng);
//alert(myLatLng);
if (AffLoc){
	var d = new Date();
	var aT = d.getTime();
	var sp = speedTime.calcul(myLatLng, aT);
	if (lastTime){
		elaps = aT - lastTime;
	}
	lastTime = aT;
	var tim = d.getHours() + ":" + (d.getMinutes()+"").padStart(2, '0') + ":" + (d.getSeconds()+"").padStart(2, '0') + ((recenter) ? " Center":"");
	window.oTip.initMess("&nbsp;<b>Lat.: </b>" + position.coords.latitude + "&nbsp;</br>&nbsp;<b>Lng.: </b>" + position.coords.longitude + "&nbsp;</br>&nbsp;<b>Diff: </b>" + elaps + " Speed: " + sp + "&nbsp;</br>&nbsp;<b>Time: </b>" + tim);
}
if (recenter)
	map.setCenter(myLatLng);
if (!watchLoc)
	locTimer = setTimeout("getLocalisation();", 500);
}

function resetAff(){
if (recenter)
	recenter = false;
else
	recenter = true;
}

function quitter(){
	clearTimeout(locTimer);
	clearGeo();
	window.close();
}

function getLocalisation(){
	if (navigator.geolocation) {
			//var options = { enableHighAccuracy:true, maximumAge:10000, timeout:10000, frequency: 2000 };
		var options = { enableHighAccuracy:true, maximumAge:0, timeout:400 };

		navigator.geolocation.getCurrentPosition(onLocSuccess, onLocAffError, options);
	}						
}

	// -->
    </script>

<style>

#menuGPS, #typeLoc {
margin: 0.4em;
font-family: Roboto, Arial, sans-serif;
font-size: 0.9em;
font-weight: bold;
}

</style>

  </head>
  <body onload='initialize()' onUnload='clearGeo()'> 

<div id="triButton">

<div id="duobutton">
<div id="fontAdjust">
<div class="divFont" onclick="setFontSize(0.2, this)"><div class="divFontSize">A</div><div class="fontLogo">&#8593;</div></div>
<div class="divFont" onclick="setFontSize(-0.2, this)"><div class="divFontSize fontSmall">A</div><div class="fontLogo">&#8595;</div></div>
</div>
<a href="#"  onclick="quitter(); return false;">Fermer</a>
<a href="#" onclick="lister(); return false;">Lister</a>
<a href="javascript:localiser()" ondblclick="resetAff()">Localiser</a>
</div></div>


<div id="mapzone">

<div id="menuGPS"><form id="typeLoc" name="typeLoc" >
<input type="radio" checked name="typeLoc">Watch</input>&nbsp;
<input type="radio" name="typeLoc" value="Get">Get</input></form></div>
	
<div id="map_canvas" ></div> 
</div>

<div id="mapZoom">
<button class="boutonZoom" title="Zoom in" onclick="zoomMap(1); return false;">+</button>
<button class="boutonZoom" title="Zoom out" onclick="zoomMap(-1); return false;">-</button>
</div>


 <div id="prefLayer"></div>
  </body> 
</html>