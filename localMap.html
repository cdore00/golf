<!DOCTYPE html>
<html>
<head>
<meta content="yes" name="apple-mobile-web-app-capable" />
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<meta content="minimum-scale=1.0, width=device-width, maximum-scale=0.6667, user-scalable=no" name="viewport" />
<meta name="format-detection" content="telephone=no" />

<link rel="shortcut icon" type="image/x-icon" href="images/golf.png?">
<title>Golfs du Qu&eacute;bec</title>
<meta content="Golf GPS, Qu&eacute;bec, Canada, Golf du Qu&eacute;bec, Clubs de golf au Qu&eacute;bec, Qu&eacute;bec golf" name="keywords" />
<meta content="R&eacute;pertoire des clubs de golf du Qu&eacute;bec. GPS golf." name="description" />
<link href="misc/init.css" rel="stylesheet" media="screen" type="text/css" />
<link href="misc/format.css" rel="stylesheet" media="screen" type="text/css" /> 

    <script type="text/javascript" 
      src="https://maps.googleapis.com/maps/api/js?key=AIzaSyA15nyiYmWG_0IkG9H5r4Qc8KhZxwRw_xA&sensor=false"> 
    </script> 
	<script type="text/javascript" src="misc/util.js"></script>
	<!--<script type="text/javascript" src="misc/markerLabel.js"></script> // -->
	<script type="text/javascript" src="misc/geoLocal.js"></script>
	
<script type="text/javascript"> 
<!--

var map;
var posMarker;
var watchId = null;
var locTimer = null;
var locCollection = null;
var watchLoc = false;
var AffLoc = false, recenter = true, showST = true;
var lastTime = 0;
var nbrMitem = 4;

var speedTime = {
	hist : [0,0,0],
	locHist : locCollection,
	lastTime : 0,
	lastPos : null,
	calcul : function (accPos,accTime) {
		var sp = 0;
		if (this.lastPos)
			var dist = calculDistance(this.lastPos, accPos);
		this.lastPos = accPos;
		
		if (dist){
			var elapsMilli = accTime - this.lastTime; 
			sp = (dist / 1760) / elapsMilli * 3600000;
			sp = Math.round(sp * 1.609344);
		}
		this.lastTime = accTime;
		
		this.hist.shift()
		this.hist[this.hist.length] = sp;
		var tot = 0, n = 0;
		for (var i = 0; i < this.hist.length; i++) {
			tot += this.hist[i];
			if (this.hist[i] > 0)
				n++;
		}
		//console.log(this.hist)
		
		return Math.round( (tot == 0) ? 0:tot/n ); 
	}
};

function initialize() { 
	locCollection = opener.locColl.coord;
	window.oTip = new messTipObject();
	window.oTip.show(false, false, false, false, -30);
	
	AffLoc = GetCookie("AffLoc");
	if (AffLoc)
		AffLoc = eval(AffLoc);
	//alert(locCollection.length);

	var myOptions = { 
	  center: new google.maps.LatLng(locCollection[locCollection.length-1].lat,locCollection[locCollection.length-1].lng), 
	  zoom: 19, 
	  panControl: false,    
	  zoomControl: false, 	  
	  scaleControl: false,
	  streetViewControl: false,
	  fullscreenControl: false, 
	  mapTypeControl: true,    
	  mapTypeControlOptions: { style: google.maps.MapTypeControlStyle.DROPDOWN_MENU, position: google.maps.ControlPosition.TOP_RIGHT   },
	  mapTypeId: google.maps.MapTypeId.HYBRID
	}; 
	map = new google.maps.Map(document.getElementById("map_canvas"), myOptions); 

	adjustScreen(31);
	setFontSize();
	//setMarkers(map, locCollection);
	setMyPosition(map, locCollection[locCollection.length-1].lat,locCollection[locCollection.length-1].lng);
	//alert(locCollection[locCollection.length-1].lat);
}

function setMyPosition(map, lat, lng) {
  // Add markers to the map
  var image = new google.maps.MarkerImage('images/ici.png',
      new google.maps.Size(14, 14),
      new google.maps.Point(0,0),
      new google.maps.Point(7, 7));
  var shape = {
      coord: [-10, -10, -10, 24, 24, 24, 24 , -10],
      type: 'poly'
  };
  //alert(location[1]);
    var myLatLng = new google.maps.LatLng(lat, lng);
    posMarker = new google.maps.Marker({
        position: myLatLng,
        map: map,
        icon: image,
        shape: shape,
        title: "Ma localisation",
        zIndex: 1000
		})
}
/*
function setMarkers(map, locations) {
  // Add markers to the map
  var image = new google.maps.MarkerImage('images/ici.png',
      new google.maps.Size(25, 25),
      new google.maps.Point(0,0),
      new google.maps.Point(0, 25));
  var shape = {
      coord: [1, 1, 1, 25, 25, 25, 25 , 1],
      type: 'poly'
  };
  for (var i = 0; i < locations.length - 1; i++) {
    var beach = locations[i];
    var myLatLng = new google.maps.LatLng(beach.lat, beach.lng);
    var marker = new MarkerWithLabel({
        position: myLatLng,
        map: map,
		draggable: true,
       labelContent: i ,
       labelAnchor: new google.maps.Point(3, 30),
       labelClass: "markLabels", // the CSS class for the label
       labelInBackground: false
		});
	}
}
*/

function lister(optLister) {
var divLayer = document.getElementById("prefLayer");

if (divLayer.style.visibility == "visible" ){
	divLayer.style.visibility="hidden";
	optLister.innerHTML = "&nbsp;&nbsp;&nbsp;&nbsp;" + langLbl["mlist"];
}else{
 divLayer.style.visibility="visible";
 optLister.innerHTML = "&#10004;&nbsp;" + langLbl["mlist"];
	var donn = "";
	for (var i=0;i<locCollection.length;i++)
	{
	donn = donn + "</br>" + (i+1) + ": " + locCollection[i].lat + ", " + locCollection[i].lng + ", Pr&eacute;c: " + locCollection[i].acc;
	}
divLayer.innerHTML = donn;
}
 //alert(locCollection.length);
}

function localiser(){

watchLoc = document.typeLoc.typeLoc[0].checked;

//navigator.geolocation.stop();
//navigator.geolocation.start();
if (watchLoc){
	clearGeo();
	getLocalisationErr();
	}else
	getLocalisation();
}

function clearGeo(){
//alert(watchId);
navigator.geolocation.clearWatch(watchId);
}

//function padStr(lng, chr, start){

//}

function onLocSuccess(position) {
var myLatLng = new google.maps.LatLng(position.coords.latitude,position.coords.longitude);
var elaps = "";

posMarker.setPosition(myLatLng);
//alert(myLatLng);
if (showST){
	var d = new Date();
	var aT = d.getTime();
	var sp = speedTime.calcul(myLatLng, aT);
	if (lastTime){
		elaps = aT - lastTime;
	}
	lastTime = aT;
	var tim = d.getHours() + ":" + (d.getMinutes()+"").padStart(2, '0') + ":" + (d.getSeconds()+"").padStart(2, '0') + ((recenter) ? " Center":"");
	//window.oTip.initMess("&nbsp;<b>Lat.: </b>" + position.coords.latitude + "&nbsp;</br>&nbsp;<b>Lng.: </b>" + position.coords.longitude + "&nbsp;</br>&nbsp;<b>Diff: </b>" + elaps + " Speed: " + sp + "&nbsp;</br>&nbsp;<b>Time: </b>" + tim);
	window.oTip.initMess("Last: " + elaps + "ms Speed: <b>" + sp + "</b></br>Time: " + tim);
}
if (recenter)
	map.setCenter(myLatLng);
if (!watchLoc)
	locTimer = setTimeout("getLocalisation();", 500);
}

function resetAff(optCenter){
if (recenter){
	recenter = false;
	optCenter.innerHTML = "&nbsp;&nbsp;&nbsp;&nbsp;" + langLbl["mcent"];
}else{
	recenter = true;
	optCenter.innerHTML = "&#10004;&nbsp;" + langLbl["mcent"];
}
}

function showSTeedTime(optST){
if (showST){
	showST = false;
	optST.innerHTML = "&nbsp;&nbsp;&nbsp;&nbsp;Speed/Time";
	window.oTip.initMess("");
}else{
	showST = true;
	optST.innerHTML = "&#10004;&nbsp;Speed/Time";
}
}

function quitter(){
	clearTimeout(locTimer);
	clearGeo();
	window.close();
}

function getLocalisation(){
	if (navigator.geolocation) {
			//var options = { enableHighAccuracy:true, maximumAge:10000, timeout:10000, frequency: 2000 };
		var options = { enableHighAccuracy:true, maximumAge:0, timeout:400 };

		navigator.geolocation.getCurrentPosition(onLocSuccess, onLocAffError, options);
	}						
}

function showMenu(){
var menuList = document.getElementById('menuList');

if (menuList.style.height != "0px" && menuList.style.height != ""){
	menuList.style.height = "0px";
}else{
	var adj = menuList.childNodes[1].offsetHeight;
	menuList.style.height = (nbrMitem * adj * .75) + "pt";
}
//menuOn = true;
}

function closeMenu(){
	var menuList = document.getElementById('menuList');
	menuList.style.height = "0px";
}

function resizeImg(fs){
	setTimeout("adjMenu()", 10);
	//alert(fs)
}

function adjMenu(){
var menuList = document.getElementById('menuList');
if (menuList.style.height != "" && menuList.style.height != "0px"){
	var adj = menuList.childNodes[1].offsetHeight;
	menuList.style.height = (nbrMitem * adj * .75) + "pt";
}
}

	// -->
    </script>

<style>

#butMenu {
visibility: visible;
}

</style>

  </head>
  <body onload='initialize()' onUnload='clearGeo()'> 



<div id="duobutton">
<div id="fontAdjust">
<div class="divFont" onclick="setFontSize(0.2, this)"><div class="divFontSize">A</div><div class="fontLogo">&#8593;</div></div>
<div class="divFont" onclick="setFontSize(-0.2, this)"><div class="divFontSize fontSmall">A</div><div class="fontLogo">&#8595;</div></div>
</div>
<a href="#" id="butMenu" title="Menu" onmouseover="showMenu()" onclick="showMenu();"><img id="logomenu" alt="Menu" src="images/menu.png" width="64" height="32"></a>
<a href="#"  onclick="quitter(); return false;">Fermer</a>
<a href="javascript:localiser()" >Localiser</a>
</div>
<div id="menuList">
<a class="inputButton" onclick="resetAff(this)" href="#">&#10004;&nbsp;<text id="mcent"></text></a>
<a class="inputButton" onclick="lister(this)" href="#">&nbsp;&nbsp;&nbsp;&nbsp;<text id="mlist"></text></a>
<a class="inputButton" onclick="showSTeedTime(this)" href="#">&#10004;&nbsp;Speed/Time</a>
<a class="inputButton" href="#">
<form id="typeLoc" name="typeLoc" >
<input id="chxWatch" type="radio" checked name="typeLoc"><label for="chxWatch">Watch</label></input>&nbsp;
<input id="chxGet" type="radio" name="typeLoc" value="Get"><label for="chxGet">Get</label></input></form>
</a>
</div>

<div id="mapzone">

<div id="map_canvas" ></div> 
</div>

<div id="mapZoom">
<button class="boutonZoom" title="Zoom in" onclick="zoomMap(1); return false;">+</button>
<button class="boutonZoom" title="Zoom out" onclick="zoomMap(-1); return false;">-</button>
</div>


 <div id="prefLayer"></div>
  </body> 
</html>